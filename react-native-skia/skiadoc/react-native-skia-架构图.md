# react-native-skia æ¶æ„å›¾

## ğŸ“Š å¿«é€Ÿæ¦‚è§ˆï¼ˆASCII å›¾ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    React Native JS å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Canvas     â”‚  â”‚    Group     â”‚  â”‚    Text      â”‚         â”‚
â”‚  â”‚  ç»„ä»¶        â”‚  â”‚   ç»„ä»¶       â”‚  â”‚   ç»„ä»¶       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                  â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                            â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚  JSI Bridge    â”‚                            â”‚
â”‚                    â”‚  SkiaManager   â”‚                            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ArkTS å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ RNCSkiaDomView   â”‚â†’ â”‚  SkiaDomView     â”‚                    â”‚
â”‚  â”‚ (RN åŒ…è£…å±‚)      â”‚  â”‚  (XComponent)    â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                â”‚                                  â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                        â”‚XComponentContextâ”‚                        â”‚
â”‚                        â”‚   (NAPI æ¥å£)   â”‚                        â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    C++ NAPI å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ napi_init    â”‚â†’ â”‚PluginManager â”‚â†’ â”‚PluginRender  â”‚          â”‚
â”‚  â”‚ (æ¨¡å—æ³¨å†Œ)    â”‚  â”‚ (æ’ä»¶ç®¡ç†)   â”‚  â”‚ (æ¸²æŸ“æ’ä»¶)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                  â”‚                   â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                     â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  C++ Skia æ ¸å¿ƒå±‚                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  RNSkView   â”‚â† â”‚RNSkHarmonyViewâ”‚â†’ â”‚RNSkOpenGL    â”‚            â”‚
â”‚  â”‚ (è§†å›¾åŸºç±»)   â”‚  â”‚ (å¹³å°è§†å›¾)    â”‚  â”‚CanvasProviderâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                  â”‚                  â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                            â”‚                                         â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                    â”‚WindowSurface   â”‚                                â”‚
â”‚                    â”‚Holder          â”‚                                â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Skia æ¸²æŸ“å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  SkSurface   â”‚â†’ â”‚   SkCanvas   â”‚â†’ â”‚GrDirectContextâ”‚            â”‚
â”‚  â”‚ (Skia è¡¨é¢)  â”‚  â”‚ (Skia ç”»å¸ƒ)   â”‚  â”‚ (GPU ä¸Šä¸‹æ–‡)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                  â”‚                  â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  OpenGL/EGL å±‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  EGLSurface  â”‚â†’ â”‚OHNativeWindowâ”‚â†’ â”‚ OpenGL é©±åŠ¨  â”‚            â”‚
â”‚  â”‚ (EGL è¡¨é¢)   â”‚  â”‚ (åŸç”Ÿçª—å£)    â”‚  â”‚ (GPU é©±åŠ¨)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                  â”‚                  â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç³»ç»Ÿå±‚                                       â”‚
â”‚                    HarmonyOS åˆæˆå™¨                                 â”‚
â”‚                        å±å¹•æ˜¾ç¤º                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•´ä½“æ¶æ„å›¾ï¼ˆMermaidï¼‰

```mermaid
graph TB
    subgraph "React Native JS å±‚"
        A[React Component<br/>Canvas/Group/Textç­‰]
        B[JSI Bridge]
        C[SkiaManager<br/>JSI ç»‘å®š]
    end
    
    subgraph "ArkTS å±‚"
        D[RNCSkiaDomView.ets<br/>RN ç»„ä»¶åŒ…è£…]
        E[SkiaDomView.ets<br/>XComponentå®¹å™¨]
        F[XComponentContext<br/>NAPI æ¥å£]
    end
    
    subgraph "C++ NAPI å±‚"
        G[napi_init.cpp<br/>NAPI æ¨¡å—æ³¨å†Œ]
        H[PluginManager<br/>æ’ä»¶ç®¡ç†]
        I[PluginRender<br/>æ¸²æŸ“æ’ä»¶]
    end
    
    subgraph "C++ Skia æ ¸å¿ƒå±‚"
        J[RNSkView<br/>Skia è§†å›¾åŸºç±»]
        K[RNSkHarmonyView<br/>Harmony è§†å›¾åŒ…è£…]
        L[RNSkOpenGLCanvasProvider<br/>Canvas æä¾›è€…]
        M[WindowSurfaceHolder<br/>Surface æŒæœ‰è€…]
    end
    
    subgraph "Skia æ¸²æŸ“å±‚"
        N[SkSurface<br/>Skia è¡¨é¢]
        O[SkCanvas<br/>Skia ç”»å¸ƒ]
        P[GrDirectContext<br/>GPU ä¸Šä¸‹æ–‡]
    end
    
    subgraph "OpenGL/EGL å±‚"
        Q[EGLSurface<br/>EGL è¡¨é¢]
        R[OHNativeWindow<br/>åŸç”Ÿçª—å£]
        S[OpenGL é©±åŠ¨]
    end
    
    subgraph "ç³»ç»Ÿå±‚"
        T[HarmonyOS<br/>ç³»ç»Ÿåˆæˆå™¨]
    end
    
    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
    G --> H
    H --> I
    I --> K
    K --> J
    K --> L
    L --> M
    M --> N
    N --> O
    O --> P
    P --> Q
    Q --> R
    R --> S
    S --> T
    
    style A fill:#e1f5ff
    style D fill:#fff4e1
    style G fill:#ffe1f5
    style J fill:#e1ffe1
    style N fill:#f5e1ff
    style Q fill:#ffe1e1
    style T fill:#e1e1e1
```

---

## ğŸ—ï¸ åˆ†å±‚æ¶æ„è¯¦è§£

### 1. React Native JS å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Native JS å±‚                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Canvas ç»„ä»¶                           â”‚
â”‚  â€¢ Group, Text, Circle ç­‰ Skia ç»„ä»¶     â”‚
â”‚  â€¢ JSI Bridge (JavaScript Interface)    â”‚
â”‚  â€¢ SkiaManager (JSI ç»‘å®š)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `Canvas` - Skia ç”»å¸ƒç»„ä»¶
- `Group`, `Text`, `Circle`, `Line` ç­‰ - Skia å›¾å½¢ç»„ä»¶
- `SkiaManager` - JSI ç»‘å®šï¼Œè¿æ¥ JS å’Œ C++

**èŒè´£ï¼š**
- å£°æ˜å¼ UI å®šä¹‰
- é€šè¿‡ JSI è°ƒç”¨ C++ å±‚
- ç®¡ç†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

---

### 2. ArkTS å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ArkTS å±‚ (HarmonyOS UI)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ RNCSkiaDomView.ets                   â”‚
â”‚    â””â”€ RN ç»„ä»¶åŒ…è£…å±‚                      â”‚
â”‚  â€¢ SkiaDomView.ets                      â”‚
â”‚    â””â”€ XComponent(SURFACE) å®¹å™¨          â”‚
â”‚  â€¢ XComponentContext                    â”‚
â”‚    â””â”€ NAPI æ¥å£å°è£…                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `RNCSkiaDomView.ets` - ä» RN descriptor åˆ›å»º SkiaDomView
- `SkiaDomView.ets` - åˆ›å»º `XComponent(SURFACE)` å®¹å™¨
- `XComponentContext` - å°è£… NAPI è°ƒç”¨

**èŒè´£ï¼š**
- æ¡¥æ¥ RN å’Œ HarmonyOS UI
- ç®¡ç† XComponent ç”Ÿå‘½å‘¨æœŸ
- å¤„ç†å°ºå¯¸å˜åŒ–äº‹ä»¶

---

### 3. C++ NAPI å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C++ NAPI å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ napi_init.cpp                        â”‚
â”‚    â””â”€ NAPI æ¨¡å—æ³¨å†Œ                      â”‚
â”‚  â€¢ PluginManager                        â”‚
â”‚    â””â”€ æ’ä»¶ç®¡ç†å™¨                        â”‚
â”‚  â€¢ PluginRender                         â”‚
â”‚    â””â”€ æ¸²æŸ“æ’ä»¶å®ç°                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `napi_init.cpp` - æ³¨å†Œ NAPI æ¨¡å— `rnoh_skia`
- `PluginManager` - ç®¡ç† XComponent å®ä¾‹
- `PluginRender` - å¤„ç† XComponent å›è°ƒ

**èŒè´£ï¼š**
- æ¡¥æ¥ ArkTS å’Œ C++ Skia å±‚
- å¤„ç† XComponent ç³»ç»Ÿå›è°ƒ
- ç®¡ç† Surface ç”Ÿå‘½å‘¨æœŸ

---

### 4. C++ Skia æ ¸å¿ƒå±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  C++ Skia æ ¸å¿ƒå±‚                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ RNSkView                             â”‚
â”‚    â””â”€ Skia è§†å›¾åŸºç±»                     â”‚
â”‚  â€¢ RNSkHarmonyView                      â”‚
â”‚    â””â”€ Harmony å¹³å°è§†å›¾åŒ…è£…              â”‚
â”‚  â€¢ RNSkOpenGLCanvasProvider             â”‚
â”‚    â””â”€ OpenGL Canvas æä¾›è€…              â”‚
â”‚  â€¢ WindowSurfaceHolder                  â”‚
â”‚    â””â”€ Surface æŒæœ‰è€…                    â”‚
â”‚  â€¢ HarmonyPlatformContext               â”‚
â”‚    â””â”€ å¹³å°ä¸Šä¸‹æ–‡                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `RNSkView` - Skia è§†å›¾åŸºç±»ï¼Œç®¡ç†æ¸²æŸ“å¾ªç¯
- `RNSkHarmonyView` - Harmony å¹³å°ç‰¹å®šå®ç°
- `RNSkOpenGLCanvasProvider` - æä¾› Canvas æ¸²æŸ“èƒ½åŠ›
- `WindowSurfaceHolder` - ç®¡ç† EGLSurface å’Œ SkSurface
- `HarmonyPlatformContext` - å¹³å°ä¸Šä¸‹æ–‡ï¼Œç®¡ç†çº¿ç¨‹å’Œä»»åŠ¡é˜Ÿåˆ—

**èŒè´£ï¼š**
- ç®¡ç† Skia è§†å›¾ç”Ÿå‘½å‘¨æœŸ
- æä¾› Canvas æ¸²æŸ“æ¥å£
- å¤„ç† Surface åˆ›å»ºå’Œé”€æ¯
- ç®¡ç†æ¸²æŸ“å¾ªç¯

---

### 5. Skia æ¸²æŸ“å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skia æ¸²æŸ“å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ SkSurface                            â”‚
â”‚    â””â”€ Skia è¡¨é¢                         â”‚
â”‚  â€¢ SkCanvas                             â”‚
â”‚    â””â”€ Skia ç”»å¸ƒ                         â”‚
â”‚  â€¢ GrDirectContext                      â”‚
â”‚    â””â”€ GPU ç›´æ¥ä¸Šä¸‹æ–‡                    â”‚
â”‚  â€¢ Skia å›¾å½¢åº“                          â”‚
â”‚    â””â”€ ç»˜åˆ¶å¼•æ“                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `SkSurface` - Skia æ¸²æŸ“è¡¨é¢
- `SkCanvas` - Skia ç”»å¸ƒï¼Œæ‰§è¡Œç»˜åˆ¶æ“ä½œ
- `GrDirectContext` - Skia GPU ä¸Šä¸‹æ–‡
- Skia å›¾å½¢åº“ - æä¾›ç»˜åˆ¶èƒ½åŠ›

**èŒè´£ï¼š**
- æ‰§è¡Œå®é™…çš„å›¾å½¢ç»˜åˆ¶
- ç®¡ç† GPU èµ„æº
- ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

---

### 6. OpenGL/EGL å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenGL/EGL å±‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ EGLSurface                           â”‚
â”‚    â””â”€ EGL è¡¨é¢                          â”‚
â”‚  â€¢ OHNativeWindow                      â”‚
â”‚    â””â”€ HarmonyOS åŸç”Ÿçª—å£                â”‚
â”‚  â€¢ OpenGL é©±åŠ¨                          â”‚
â”‚    â””â”€ GPU é©±åŠ¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸»è¦ç»„ä»¶ï¼š**
- `EGLSurface` - EGL æ¸²æŸ“è¡¨é¢
- `OHNativeWindow` - HarmonyOS åŸç”Ÿçª—å£å¥æŸ„
- OpenGL é©±åŠ¨ - GPU é©±åŠ¨å±‚

**èŒè´£ï¼š**
- ç®¡ç† OpenGL ä¸Šä¸‹æ–‡
- æä¾› GPU æ¸²æŸ“èƒ½åŠ›
- ä¸ç³»ç»Ÿçª—å£ç³»ç»Ÿäº¤äº’

---

## ğŸ”„ æ•°æ®æµå‘å›¾

```mermaid
sequenceDiagram
    participant JS as React JS
    participant ArkTS as ArkTS
    participant NAPI as NAPI
    participant Skia as Skia Core
    participant GL as OpenGL/EGL
    participant Sys as System
    
    Note over JS,Sys: åˆå§‹åŒ–é˜¶æ®µ
    JS->>ArkTS: åˆ›å»º Canvas ç»„ä»¶
    ArkTS->>NAPI: registerView()
    NAPI->>Skia: åˆ›å»º RNSkView
    Sys->>NAPI: OnSurfaceCreated
    NAPI->>Skia: surfaceAvailable()
    Skia->>GL: åˆ›å»º EGLSurface
    GL->>Skia: è¿”å› OHNativeWindow
    
    Note over JS,Sys: æ¸²æŸ“é˜¶æ®µ
    JS->>Skia: ç»˜åˆ¶æŒ‡ä»¤ (JSI)
    Skia->>Skia: renderToCanvas()
    Skia->>GL: getSurface()
    GL->>Skia: è¿”å› SkSurface
    Skia->>Skia: canvas->drawXXX()
    Skia->>GL: flushAndSubmit()
    GL->>GL: swapBuffers()
    GL->>Sys: æäº¤å¸§åˆ°ç³»ç»Ÿ
    Sys->>Sys: åˆæˆå¹¶æ˜¾ç¤º
```

---

## ğŸ§µ çº¿ç¨‹æ¨¡å‹æ¶æ„å›¾

```mermaid
graph LR
    subgraph "JS çº¿ç¨‹"
        A[React æ¸²æŸ“]
        B[JSI è°ƒç”¨]
    end
    
    subgraph "ArkUI UI çº¿ç¨‹"
        C[ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ]
        D[onSizeChange]
    end
    
    subgraph "NAPI å›è°ƒçº¿ç¨‹"
        E[OnSurfaceCreated]
        F[OnSurfaceChanged]
    end
    
    subgraph "Skia å¹³å°çº¿ç¨‹"
        G[runTaskOnMainThread]
        H[ä»»åŠ¡é˜Ÿåˆ—]
    end
    
    subgraph "PlayLink çº¿ç¨‹"
        I[å®šæ—¶å™¨å¾ªç¯]
    end
    
    subgraph "GPU é©±åŠ¨çº¿ç¨‹"
        J[OpenGL æ‰§è¡Œ]
    end
    
    A --> B
    C --> D
    E --> G
    F --> G
    I --> G
    G --> H
    H --> J
    
    style A fill:#e1f5ff
    style C fill:#fff4e1
    style E fill:#ffe1f5
    style G fill:#e1ffe1
    style I fill:#f5e1ff
    style J fill:#ffe1e1
```

---

## ğŸ“¦ ç»„ä»¶å…³ç³»å›¾

```mermaid
classDiagram
    class RNSkView {
        +requestRedraw()
        +draw()
        +renderImmediate()
    }
    
    class RNSkHarmonyView {
        +surfaceAvailable()
        +surfaceDestroyed()
        +surfaceSizeChanged()
    }
    
    class RNSkOpenGLCanvasProvider {
        +renderToCanvas()
        +surfaceAvailable()
        +surfaceSizeChanged()
    }
    
    class WindowSurfaceHolder {
        +getSurface()
        +resize()
        +present()
    }
    
    class HarmonyPlatformContext {
        +startDrawLoop()
        +runOnMainThread()
        +notifyDrawLoop()
    }
    
    class PlayLink {
        +startDrawLoop()
        +postFrameLoop()
    }
    
    RNSkView <|-- RNSkHarmonyView
    RNSkHarmonyView --> RNSkOpenGLCanvasProvider
    RNSkOpenGLCanvasProvider --> WindowSurfaceHolder
    HarmonyPlatformContext --> PlayLink
    RNSkView --> HarmonyPlatformContext
    
    note for RNSkView "Skia è§†å›¾åŸºç±»"
    note for RNSkHarmonyView "Harmony å¹³å°å®ç°"
    note for RNSkOpenGLCanvasProvider "Canvas æä¾›è€…"
    note for WindowSurfaceHolder "Surface ç®¡ç†"
```

---

## ğŸ”§ å…³é”®æ¥å£è°ƒç”¨é“¾

### åˆå§‹åŒ–æµç¨‹

```
1. React JS å±‚
   â””â”€ <Canvas> ç»„ä»¶æ¸²æŸ“
       â†“
2. ArkTS å±‚
   â””â”€ SkiaDomView.aboutToAppear()
       â””â”€ XComponent åˆ›å»º
           â†“
3. NAPI å±‚
   â””â”€ PluginManager::Export()
       â””â”€ æ³¨å†Œ XComponent å›è°ƒ
           â†“
4. ç³»ç»Ÿå›è°ƒ
   â””â”€ OnSurfaceCreated()
       â””â”€ è·å– OHNativeWindow
           â†“
5. NAPI å±‚
   â””â”€ PluginRender::RegisterView()
       â””â”€ ç»‘å®š nativeID â†” RNSkView
           â†“
6. Skia æ ¸å¿ƒå±‚
   â””â”€ RNSkHarmonyView::surfaceAvailable()
       â””â”€ RNSkOpenGLCanvasProvider::surfaceAvailable()
           â””â”€ åˆ›å»º WindowSurfaceHolder
```

### æ¸²æŸ“æµç¨‹

```
1. PlayLink çº¿ç¨‹
   â””â”€ å®šæ—¶è§¦å‘ (æ¯ 16.667ms)
       â†“
2. Skia å¹³å°çº¿ç¨‹
   â””â”€ HarmonyPlatformContext::notifyDrawLoop()
       â””â”€ RNSkView::draw()
           â†“
3. Skia æ ¸å¿ƒå±‚
   â””â”€ RNSkOpenGLCanvasProvider::renderToCanvas()
       â””â”€ WindowSurfaceHolder::getSurface()
           â””â”€ åˆ›å»º/è·å– SkSurface
               â†“
4. Skia æ¸²æŸ“å±‚
   â””â”€ SkCanvas::drawXXX()
       â””â”€ æ‰§è¡Œç»˜åˆ¶æ“ä½œ
           â†“
5. OpenGL å±‚
   â””â”€ GrDirectContext::flushAndSubmit()
       â””â”€ eglSwapBuffers()
           â†“
6. ç³»ç»Ÿå±‚
   â””â”€ åˆæˆå¹¶æ˜¾ç¤º
```

---

## ğŸ¯ æ ¸å¿ƒæ•°æ®ç»“æ„

### 1. WindowSurfaceHolder

```
WindowSurfaceHolder
â”œâ”€ OHNativeWindow* _window      // åŸç”Ÿçª—å£
â”œâ”€ EGLSurface _glSurface        // EGL è¡¨é¢
â”œâ”€ sk_sp<SkSurface> _skSurface  // Skia è¡¨é¢
â”œâ”€ int _width                   // å®½åº¦
â””â”€ int _height                  // é«˜åº¦
```

### 2. RNSkOpenGLCanvasProvider

```
RNSkOpenGLCanvasProvider
â”œâ”€ std::unique_ptr<WindowSurfaceHolder> _surfaceHolder
â””â”€ std::shared_ptr<RNSkPlatformContext> _platformContext
```

### 3. HarmonyPlatformContext

```
HarmonyPlatformContext
â”œâ”€ std::unique_ptr<PlayLink> playLink
â”œâ”€ std::thread mainThread
â”œâ”€ std::queue<std::function<void()>> taskQueue
â””â”€ std::mutex taskMutex
```

---

## ğŸ“ æ€»ç»“

### æ¶æ„ç‰¹ç‚¹

1. **åˆ†å±‚æ¸…æ™°**ï¼šJS â†’ ArkTS â†’ NAPI â†’ Skia â†’ OpenGL â†’ ç³»ç»Ÿ
2. **èŒè´£æ˜ç¡®**ï¼šæ¯å±‚è´Ÿè´£ç‰¹å®šåŠŸèƒ½
3. **å¼‚æ­¥å¤„ç†**ï¼šå¤šçº¿ç¨‹åä½œï¼Œä¿è¯æ€§èƒ½
4. **å¹³å°æŠ½è±¡**ï¼šé€šè¿‡ PlatformContext æŠ½è±¡å¹³å°å·®å¼‚

### å…³é”®è®¾è®¡æ¨¡å¼

- **æ¡¥æ¥æ¨¡å¼**ï¼šJS â†” ArkTS â†” C++
- **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šPlayLink å®šæ—¶è§¦å‘æ¸²æŸ“
- **å·¥å‚æ¨¡å¼**ï¼šSurface åˆ›å»º
- **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒå¹³å°çš„å®ç°

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: AI Assistant
